{"ast":null,"code":"var _jsxFileName = \"/Users/heangzhan/Desktop/se2021_part1/se2021/src/PersonalInfo/UserInfo.jsx\";\nimport React from 'react';\nimport { Layout, Menu, Form, Input, Button, message } from 'antd';\nimport { Link } from 'react-router-dom';\nimport '../assets/css/PersonalInfo.css';\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet storage = window.localStorage;\nconst defaultUrl = 'http://127.0.0.1:5003';\nconst formItemLayout = {\n  labelCol: {\n    xs: {\n      span: 24\n    },\n    sm: {\n      span: 8\n    }\n  },\n  wrapperCol: {\n    xs: {\n      span: 24\n    },\n    sm: {\n      span: 16\n    }\n  }\n};\nconst tailFormItemLayout = {\n  wrapperCol: {\n    xs: {\n      span: 24,\n      offset: 0\n    },\n    sm: {\n      span: 16,\n      offset: 8\n    }\n  }\n};\nlet newNickname = '';\nlet newEmail = '';\nlet newPhone = '';\nlet newAddress = '';\n\nclass UserInfo extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.getAddress = e => {\n      newAddress = e.target.value;\n    };\n\n    this.getNickname = e => {\n      newNickname = e.target.value;\n    };\n\n    this.getEmail = e => {\n      newEmail = e.target.value;\n    };\n\n    this.getPhone = e => {\n      newPhone = e.target.value;\n    };\n\n    this.infoModPost = () => {\n      if (newNickname !== this.state.nickname || newEmail !== this.state.email || newPhone !== this.state.phone || newAddress !== this.state.address) {\n        this.setState({\n          infoModLoading: true\n        });\n        let params = {\n          uid: this.state.username,\n          email: newEmail,\n          nickname: newNickname,\n          phone: newPhone,\n          address: newAddress\n        };\n        console.log(params);\n        axios({\n          baseURL: defaultUrl,\n          method: 'put',\n          url: '/changeInfo',\n          params\n        }).then(res => {\n          console.log(res.data.msg);\n\n          if (!res.data.code) {\n            message.success('个人信息修改成功!');\n            this.setState({\n              infoModLoading: false,\n              nickname: newNickname,\n              email: newEmail,\n              phone: newPhone,\n              address: newAddress\n            }); // window.location.href = \"http://localhost:3000\"\n          } else {\n            message.error('修改失败请重试！');\n            this.setState({\n              infoModLoading: false\n            });\n          }\n        });\n      } else {\n        message.error('至少提供一项修改！');\n      }\n    };\n\n    this.getOldPassword = e => {\n      this.setState({\n        oldPassword: e.target.value\n      });\n    };\n\n    this.getNewPassword = e => {\n      this.setState({\n        newPassword: e.target.value\n      });\n    };\n\n    this.psdModPost = () => {\n      if (this.state.newPassword !== '' && this.state.oldPassword !== '') {\n        this.setState({\n          psdModLoading: true\n        });\n        let params = {\n          uid: this.state.username,\n          oldPassword: this.state.oldPassword,\n          newPassword: this.state.newPassword\n        };\n        console.log(params);\n        axios({\n          baseURL: defaultUrl,\n          method: 'post',\n          url: '/psdModPage',\n          params\n        }).then(res => {\n          console.log(res.data.msg);\n\n          if (!res.data.code) {\n            message.success('密码修改成功，请重新登录!');\n            this.setState({\n              psdModLoading: false\n            });\n            storage.removeItem(\"user\");\n            storage.removeItem(\"token\");\n            storage.removeItem('identity');\n            storage.removeItem(\"nickname\");\n            storage.removeItem(\"email\");\n            storage.removeItem('phone');\n            storage.removeItem('address');\n            window.location.href = \"http://localhost:3000\";\n          } else {\n            message.error('修改失败请重试！');\n            this.setState({\n              psdModLoading: false\n            });\n          }\n        });\n      } else {\n        message.error('请输入完整信息！');\n      }\n    };\n\n    this.state = {\n      username: storage['user'],\n      identity: storage['identity'],\n      nickname: storage['nickname'],\n      email: storage['email'],\n      phone: storage['phone'],\n      address: storage['address'],\n      collapsed: false,\n      infoModLoading: false,\n      psdModLoading: false,\n      oldPassword: '',\n      newPassword: ''\n    };\n  }\n\n  componentDidMount() {\n    newNickname = this.state.nickname;\n    newPhone = this.state.phone;\n    newEmail = this.state.email;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Form, {\n      className: \"personalInfo-form\",\n      style: {\n        width: \"50%\"\n      },\n      ...formItemLayout,\n      name: \"personalInfo\",\n      scrollToFirstError: true,\n      children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"uid\",\n        label: \"\\u8EAB\\u4EFD\\u8BC1\\u53F7\",\n        children: this.state.username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"nickname\",\n        label: \"\\u7528\\u6237\\u6635\\u79F0\",\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.nickname,\n          onChange: e => this.getNickname(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"email\",\n        label: \"\\u6CE8\\u518C\\u90AE\\u7BB1\",\n        rules: [{\n          type: 'email',\n          message: '请输入正确的邮件地址!'\n        }],\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.email,\n          onChange: e => this.getEmail(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"phone\",\n        label: \"\\u8054\\u7CFB\\u7535\\u8BDD\",\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.phone,\n          onChange: e => this.getPhone(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"address\",\n        label: \"\\u5C45\\u4F4F\\u5730\\u5740\",\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.address,\n          onChange: e => this.getAddress(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, { ...tailFormItemLayout,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          onClick: this.infoModPost,\n          loading: this.state.infoModLoading,\n          children: \"\\u4FEE\\u6539\\u8D44\\u6599\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"oldPassword\",\n        label: \"\\u8F93\\u5165\\u65E7\\u5BC6\\u7801\",\n        hasFeedback: true,\n        children: /*#__PURE__*/_jsxDEV(Input.Password, {\n          onChange: e => this.getOldPassword(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"newPassword\",\n        label: \"\\u8F93\\u5165\\u65B0\\u5BC6\\u7801\",\n        hasFeedback: true,\n        children: /*#__PURE__*/_jsxDEV(Input.Password, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"confirm\",\n        label: \"\\u786E\\u8BA4\\u65B0\\u5BC6\\u7801\",\n        dependencies: ['newPassword'],\n        hasFeedback: true,\n        rules: [({\n          getFieldValue\n        }) => ({\n          validator(_, value) {\n            if (!value || getFieldValue('newPassword') === value) {\n              return Promise.resolve();\n            }\n\n            return Promise.reject(new Error('两次密码不一致!'));\n          }\n\n        })],\n        children: /*#__PURE__*/_jsxDEV(Input.Password, {\n          onChange: e => this.getNewPassword(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, { ...tailFormItemLayout,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          onClick: this.psdModPost,\n          loading: this.state.psdModLoading,\n          children: \"\\u4FEE\\u6539\\u5BC6\\u7801\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default UserInfo;","map":{"version":3,"sources":["/Users/heangzhan/Desktop/se2021_part1/se2021/src/PersonalInfo/UserInfo.jsx"],"names":["React","Layout","Menu","Form","Input","Button","message","Link","axios","storage","window","localStorage","defaultUrl","formItemLayout","labelCol","xs","span","sm","wrapperCol","tailFormItemLayout","offset","newNickname","newEmail","newPhone","newAddress","UserInfo","Component","constructor","props","getAddress","e","target","value","getNickname","getEmail","getPhone","infoModPost","state","nickname","email","phone","address","setState","infoModLoading","params","uid","username","console","log","baseURL","method","url","then","res","data","msg","code","success","error","getOldPassword","oldPassword","getNewPassword","newPassword","psdModPost","psdModLoading","removeItem","location","href","identity","collapsed","componentDidMount","render","width","type","getFieldValue","validator","_","Promise","resolve","reject","Error"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {Layout, Menu, Form, Input, Button, message} from 'antd';\nimport { Link } from 'react-router-dom';\nimport '../assets/css/PersonalInfo.css';\nimport axios from \"axios\";\n\nlet storage = window.localStorage;\nconst defaultUrl = 'http://127.0.0.1:5003';\n\nconst formItemLayout = {\n    labelCol: {\n        xs: { span: 24 },\n        sm: { span: 8 },\n    },\n    wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 },\n    },\n};\nconst tailFormItemLayout = {\n    wrapperCol: {\n        xs: {\n            span: 24,\n            offset: 0,\n        },\n        sm: {\n            span: 16,\n            offset: 8,\n        },\n    },\n};\n\nlet newNickname = '';\nlet newEmail = '';\nlet newPhone = '';\nlet newAddress = '';\n\nclass UserInfo extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state={\n            username:storage['user'],\n            identity:storage['identity'],\n            nickname:storage['nickname'],\n            email:storage['email'],\n            phone:storage['phone'],\n            address:storage['address'],\n            collapsed: false,\n            infoModLoading:false,\n            psdModLoading:false,\n            oldPassword:'',\n            newPassword:'',\n        }\n    }\n\n    componentDidMount() {\n        newNickname = this.state.nickname\n        newPhone = this.state.phone\n        newEmail = this.state.email\n    }\n    getAddress=(e)=> {\n        newAddress = e.target.value\n    }\n\n    getNickname=(e)=>{\n        newNickname = e.target.value\n    }\n\n    getEmail=(e)=>{\n        newEmail = e.target.value\n    }\n\n    getPhone=(e)=>{\n        newPhone = e.target.value\n    }\n\n    infoModPost=()=>{\n        if (newNickname !== this.state.nickname || newEmail !== this.state.email || newPhone !== this.state.phone || newAddress !== this.state.address) {\n            this.setState({\n            infoModLoading:true\n            });\n            let params={\n                uid:this.state.username,\n                email:newEmail,\n                nickname:newNickname,\n                phone:newPhone,\n                address:newAddress\n            };\n            console.log(params)\n            axios({\n                baseURL:defaultUrl,\n                method:'put',\n                url:'/changeInfo',\n                params,\n            }).then(res=>{\n                console.log(res.data.msg)\n                if(!res.data.code) {\n                    message.success('个人信息修改成功!');\n                    this.setState({\n                        infoModLoading:false,\n                        nickname:newNickname,\n                        email:newEmail,\n                        phone:newPhone,\n                        address:newAddress,\n                    });\n                    // window.location.href = \"http://localhost:3000\"\n                }\n                else{\n                    message.error('修改失败请重试！');\n                    this.setState({\n                        infoModLoading:false,\n                    });\n                }\n            })\n        } else {\n            message.error('至少提供一项修改！')\n        }\n    }\n\n    getOldPassword=(e)=>{\n        this.setState({\n            oldPassword:e.target.value\n        })\n    }\n\n    getNewPassword=(e)=>{\n        this.setState({\n            newPassword:e.target.value\n        })\n    }\n\n    psdModPost=()=>{\n        if (this.state.newPassword !== '' && this.state.oldPassword !== '') {\n            this.setState({\n            psdModLoading:true\n            });\n            let params={\n                uid:this.state.username,\n                oldPassword: this.state.oldPassword,\n                newPassword: this.state.newPassword,\n            };\n            console.log(params)\n            axios({\n                baseURL:defaultUrl,\n                method:'post',\n                url:'/psdModPage',\n                params,\n            }).then(res=>{\n                console.log(res.data.msg)\n                if(!res.data.code) {\n                    message.success('密码修改成功，请重新登录!');\n                    this.setState({\n                        psdModLoading:false,\n                    });\n                    storage.removeItem(\"user\");\n                    storage.removeItem(\"token\");\n                    storage.removeItem('identity')\n                    storage.removeItem(\"nickname\");\n                    storage.removeItem(\"email\");\n                    storage.removeItem('phone');\n                    storage.removeItem('address');\n                    window.location.href = \"http://localhost:3000\"\n                }\n                else{\n                    message.error('修改失败请重试！');\n                    this.setState({\n                        psdModLoading:false,\n                    });\n                }\n            })\n        } else {\n            message.error('请输入完整信息！');\n        }\n    }\n\n    render() {\n        return (\n            <Form\n                className=\"personalInfo-form\"\n                style={{width:\"50%\"}}\n                {...formItemLayout}\n                name=\"personalInfo\"\n                scrollToFirstError\n            >\n                <Form.Item\n                    name=\"uid\"\n                    label=\"身份证号\"\n                >\n                    {this.state.username}\n                </Form.Item>\n\n                <Form.Item\n                    name=\"nickname\"\n                    label=\"用户昵称\"\n                >\n                    <Input\n                        placeholder={this.state.nickname}\n                        onChange={(e)=>this.getNickname(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item\n                    name=\"email\"\n                    label=\"注册邮箱\"\n                    rules={[\n                        {\n                            type: 'email',\n                            message: '请输入正确的邮件地址!',\n                        }\n                    ]}\n                >\n                    <Input\n                        placeholder={this.state.email}\n                        onChange={(e)=>this.getEmail(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item\n                    name=\"phone\"\n                    label=\"联系电话\"\n                >\n                    <Input\n                        placeholder={this.state.phone}\n                        onChange={(e)=>this.getPhone(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item\n                    name=\"address\"\n                    label=\"居住地址\"\n                >\n                    <Input\n                        placeholder={this.state.address}\n                        onChange={(e)=>this.getAddress(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item {...tailFormItemLayout}>\n                    <Button\n                        type=\"primary\"\n                        htmlType=\"submit\"\n                        onClick={this.infoModPost}\n                        loading={this.state.infoModLoading}\n                    >\n                        修改资料\n                    </Button>\n                </Form.Item>\n\n                <Form.Item\n                    name=\"oldPassword\"\n                    label=\"输入旧密码\"\n                    hasFeedback\n                >\n                    <Input.Password onChange={(e)=>this.getOldPassword(e)}/>\n                </Form.Item>\n\n                <Form.Item\n                    name=\"newPassword\"\n                    label=\"输入新密码\"\n                    hasFeedback\n                >\n                    <Input.Password/>\n                </Form.Item>\n\n                <Form.Item\n                    name=\"confirm\"\n                    label=\"确认新密码\"\n                    dependencies={['newPassword']}\n                    hasFeedback\n                    rules={[\n                        ({ getFieldValue }) => ({validator(_, value) {\n                            if (!value || getFieldValue('newPassword') === value) {\n                                return Promise.resolve();\n                            }\n                            return Promise.reject(new Error('两次密码不一致!'));\n                        },}),\n                    ]}\n                >\n                    <Input.Password onChange={(e)=>this.getNewPassword(e)}/>\n                </Form.Item>\n\n                <Form.Item {...tailFormItemLayout}>\n                    <Button\n                        type=\"primary\"\n                        htmlType=\"submit\"\n                        onClick={this.psdModPost}\n                        loading={this.state.psdModLoading}\n                    >\n                        修改密码\n                    </Button>\n                </Form.Item>\n            </Form>\n      )\n    }\n}\n\nexport default UserInfo;\n"]},"metadata":{},"sourceType":"module"}