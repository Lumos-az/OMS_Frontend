{"ast":null,"code":"var _jsxFileName = \"/Users/heangzhan/Desktop/se2021_part1/se2021/src/Component/TopBar.jsx\";\nimport React from 'react';\nimport { Button, Menu, Dropdown, message, Modal, Form, Input, Checkbox } from 'antd';\nimport TopMenu from './TopMenu';\nimport '../assets/css/TopBar.css';\nimport { UserOutlined, LockOutlined, EyeInvisibleOutlined, EyeTwoTone } from '@ant-design/icons';\nimport { Link } from 'react-router-dom';\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar storage = window.localStorage;\nconst defaultUrl = 'http://127.0.0.1:5003';\n\nclass TopBar extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.login = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.getUsername = e => {\n      this.setState({\n        username: e.target.value\n      });\n    };\n\n    this.getPassword = e => {\n      this.setState({\n        userPassword: e.target.value\n      });\n    };\n\n    this.loginPost = () => {\n      if (this.state.username !== null && this.state.userPassword !== null) {\n        this.setState({\n          loading: true\n        });\n        let params = {\n          username: this.state.username,\n          password: this.state.userPassword\n        };\n        console.log(params);\n        axios({\n          baseURL: defaultUrl,\n          method: 'get',\n          url: '/login',\n          params\n        }).then(res => {\n          console.log(res);\n\n          if (res.data.data !== null) {\n            console.log(res);\n            storage['token'] = res.data.data.token;\n            storage['user'] = this.state.username;\n            storage['identity'] = res.data.data.identity;\n            message.success('登录成功!');\n            this.setState({\n              visible: false,\n              loading: false,\n              getMenu: false\n            });\n          } else {\n            message.error('用户名或密码错误！');\n            this.setState({\n              loading: false\n            });\n          }\n        });\n      }\n    };\n\n    this.register = () => {};\n\n    this.logout = () => {\n      storage.removeItem(\"user\");\n      storage.removeItem(\"token\");\n      storage.removeItem('identity');\n      message.success('登出成功'); // window.location.reload();\n\n      window.location.href = window.location.href; // 注销则跳转到首页\n    };\n\n    this.loginMenu = /*#__PURE__*/_jsxDEV(Menu, {\n      children: [/*#__PURE__*/_jsxDEV(Menu.Item, {\n        children: [\" \", /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: this.login,\n          children: \"\\u767B\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 35\n        }, this), \" \"]\n      }, 'login', true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Menu.Item, {\n        children: [\" \", /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/RegisterPage/\",\n          children: \"\\u6CE8\\u518C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 38\n        }, this), \" \"]\n      }, 'register', true, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }, this);\n    this.logoutMenu = /*#__PURE__*/_jsxDEV(Menu, {\n      children: /*#__PURE__*/_jsxDEV(Menu.Item, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: this.logout,\n          children: \"\\u9000\\u51FA\\u767B\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 38\n        }, this)\n      }, 'logout', false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 9\n    }, this);\n    this.state = {\n      visible: false,\n      getMenu: true,\n      loading: false,\n      username: null,\n      userPassword: null\n    };\n  }\n\n  componentDidMount() {\n    if (storage['token'] === undefined) {\n      this.setState({\n        getMenu: true\n      });\n      storage['islogin'] = false;\n    } else {\n      axios({\n        baseURL: defaultUrl,\n        method: 'post',\n        url: '/islogin',\n        headers: {\n          'Token': storage['token']\n        }\n      }).then(res => {\n        if (res.data.code !== 0) {\n          storage['islogin'] = false;\n        } else {\n          storage['islogin'] = true;\n          this.setState({\n            getMenu: false\n          });\n        }\n\n        console.log(storage['islogin']);\n      });\n    }\n\n    console.log(this.state.getMenu, this.state.visible);\n    console.log(storage['token'], storage['identity']);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"TopBar\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        className: \"logo\",\n        src: require('../assets/picture/logo.jpg').default,\n        alt: \"logo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title\",\n        children: \"\\u667A\\u6167\\u533B\\u7597\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          alignSelf: 'flex-end'\n        },\n        className: \"Menu\",\n        children: /*#__PURE__*/_jsxDEV(TopMenu, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 71\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"username\",\n        children: this.state.getMenu === true ? '' : storage['user'] + ',欢迎使用！'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this), this.state.getMenu === false && storage['identity'] === '2' ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginLeft: 'auto'\n        },\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: '/admin',\n            children: \"\\u7BA1\\u7406\\u5458\\u4E2D\\u5FC3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 25\n      }, this) : '', this.state.getMenu === false && storage['identity'] === '0' ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginLeft: 'auto'\n        },\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: '/PersonalInfo',\n            children: \"\\u7528\\u6237\\u4E2D\\u5FC3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 25\n      }, this) : '', /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"User\",\n        children: this.state.getMenu === true ? /*#__PURE__*/_jsxDEV(Dropdown, {\n          overlay: this.loginMenu,\n          trigger: ['click'],\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            size: \"large\",\n            shape: \"circle\",\n            icon: /*#__PURE__*/_jsxDEV(UserOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 79\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 29\n        }, this) : /*#__PURE__*/_jsxDEV(Dropdown, {\n          overlay: this.logoutMenu,\n          trigger: ['click'],\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            size: \"large\",\n            shape: \"circle\",\n            icon: /*#__PURE__*/_jsxDEV(UserOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 79\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        visible: this.state.visible,\n        footer: null,\n        onCancel: this.handleCancel,\n        destroyOnClose: true,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"user-login\",\n          children: /*#__PURE__*/_jsxDEV(Form, {\n            name: \"normal_login\",\n            className: \"login-form\",\n            initialValues: {\n              remember: true\n            },\n            style: {\n              width: \"100%\"\n            },\n            preserve: false,\n            children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n              name: \"username\",\n              rules: [{\n                required: true,\n                message: '请输入用户名!'\n              }],\n              children: /*#__PURE__*/_jsxDEV(Input, {\n                prefix: /*#__PURE__*/_jsxDEV(UserOutlined, {\n                  className: \"site-form-item-icon\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 229,\n                  columnNumber: 45\n                }, this),\n                placeholder: \"\\u7528\\u6237\\u540D\",\n                type: \"username\",\n                onChange: e => this.getUsername(e)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 228,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 219,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n              name: \"password\",\n              rules: [{\n                required: true,\n                message: '请输入密码!'\n              }],\n              children: /*#__PURE__*/_jsxDEV(Input.Password, {\n                prefix: /*#__PURE__*/_jsxDEV(LockOutlined, {\n                  className: \"site-form-item-icon\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 45\n                }, this),\n                type: \"password\",\n                placeholder: \"\\u5BC6\\u7801\",\n                onChange: e => this.getPassword(e),\n                iconRender: visible => visible ? /*#__PURE__*/_jsxDEV(EyeTwoTone, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 249,\n                  columnNumber: 71\n                }, this) : /*#__PURE__*/_jsxDEV(EyeInvisibleOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 249,\n                  columnNumber: 88\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n              children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n                name: \"remember\",\n                valuePropName: \"checked\",\n                noStyle: true,\n                children: /*#__PURE__*/_jsxDEV(Checkbox, {\n                  children: \"\\u8BB0\\u4F4F\\u6211\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"login-form-forgot\",\n                href: \"\",\n                style: {\n                  color: 'blue'\n                },\n                children: /*#__PURE__*/_jsxDEV(Link, {\n                  to: \"/FindPasswordPage/\",\n                  children: \"\\u5FD8\\u8BB0\\u5BC6\\u7801\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 260,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                type: \"primary\",\n                htmlType: \"submit\",\n                className: \"login-form-button\",\n                onClick: this.loginPost,\n                loading: this.state.loading,\n                children: \"\\u767B\\u5F55\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 265,\n                columnNumber: 33\n              }, this), \"\\u6216\\u8005 \", /*#__PURE__*/_jsxDEV(\"a\", {\n                href: \"\",\n                style: {\n                  color: 'blue'\n                },\n                children: /*#__PURE__*/_jsxDEV(Link, {\n                  to: \"/RegisterPage/\",\n                  children: \"\\u73B0\\u5728\\u6CE8\\u518C\\uFF01\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 274,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 36\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default TopBar;","map":{"version":3,"sources":["/Users/heangzhan/Desktop/se2021_part1/se2021/src/Component/TopBar.jsx"],"names":["React","Button","Menu","Dropdown","message","Modal","Form","Input","Checkbox","TopMenu","UserOutlined","LockOutlined","EyeInvisibleOutlined","EyeTwoTone","Link","axios","storage","window","localStorage","defaultUrl","TopBar","Component","constructor","props","login","setState","visible","handleCancel","getUsername","e","username","target","value","getPassword","userPassword","loginPost","state","loading","params","password","console","log","baseURL","method","url","then","res","data","token","identity","success","getMenu","error","register","logout","removeItem","location","href","loginMenu","logoutMenu","componentDidMount","undefined","headers","code","render","require","default","alignSelf","marginLeft","remember","width","required","color"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Button, Menu, Dropdown, message, Modal, Form, Input, Checkbox } from 'antd';\nimport TopMenu from './TopMenu';\nimport '../assets/css/TopBar.css';\nimport { UserOutlined, LockOutlined, EyeInvisibleOutlined, EyeTwoTone } from '@ant-design/icons';\nimport { Link } from 'react-router-dom';\nimport axios from \"axios\";\n\nvar storage=window.localStorage;\nconst defaultUrl = 'http://127.0.0.1:5003';\n\n\n\nclass TopBar extends React.Component{\n    constructor(props) {\n        super(props);\n        this.state = {\n            visible:false,\n            getMenu:true,\n            loading:false,\n            username:null,\n            userPassword:null,\n        }\n    };\n\n    componentDidMount() {\n        if(storage['token']===undefined){\n            this.setState({\n                getMenu:true\n            })\n            storage['islogin']=false\n        }\n        else{\n            axios({\n                baseURL:defaultUrl,\n                method:'post',\n                url:'/islogin',\n                headers:{\n                    'Token':storage['token']\n                }\n            }).then(res=>{\n                if(res.data.code!==0){\n\n                    storage['islogin']=false\n                }\n                else{\n                    storage['islogin']=true\n                    this.setState({\n                        getMenu:false,\n                    })\n                }\n                console.log(storage['islogin'])\n            })\n        }\n        console.log(this.state.getMenu, this.state.visible)\n        console.log(storage['token'], storage['identity'])\n    };\n\n    login=()=> {\n        this.setState({\n            visible:true,\n        })\n    };\n\n    handleCancel=()=> {\n        this.setState({\n            visible: false,\n        });\n    }\n\n    getUsername=(e)=>{\n        this.setState({\n            username:e.target.value\n        })\n    };\n\n    getPassword=(e)=>{\n        this.setState({\n            userPassword:e.target.value\n        })\n    };\n\n    loginPost=()=> {\n        if(this.state.username !== null && this.state.userPassword !== null) {\n            this.setState({\n                loading:true\n            });\n\n            let params={\n                username:this.state.username,\n                password:this.state.userPassword,\n            };\n            console.log(params)\n            axios({\n                baseURL:defaultUrl,\n                method:'get',\n                url:'/login',\n                params,\n            }).then(res=>{\n                console.log(res)\n                if(res.data.data!==null) {\n                    console.log(res)\n                    storage['token']=res.data.data.token;\n                    storage['user']=this.state.username;\n                    storage['identity']=res.data.data.identity;\n                    message.success('登录成功!');\n                    this.setState({\n                        visible:false,\n                        loading:false,\n                        getMenu:false,\n                    });\n                }\n                else{\n                    message.error('用户名或密码错误！');\n                    this.setState({\n                        loading:false\n                    });\n                }\n            })\n        }\n\n    };\n\n    register=()=> {\n\n    };\n\n    logout=()=> {\n        storage.removeItem(\"user\");\n        storage.removeItem(\"token\");\n        storage.removeItem('identity')\n\n        message.success('登出成功')\n        // window.location.reload();\n        window.location.href = window.location.href// 注销则跳转到首页\n    };\n\n    loginMenu=(\n        <Menu>\n          <Menu.Item key='login'> <div onClick={this.login}>登录</div> </Menu.Item>\n          <Menu.Item key='register'> <Link to=\"/RegisterPage/\">注册</Link> </Menu.Item>\n        </Menu>\n    );\n\n    logoutMenu=(\n        <Menu>\n            <Menu.Item key='logout' ><div onClick={this.logout} >退出登录</div></Menu.Item>\n        </Menu>\n    );\n\n    render() {\n        return(\n            <div className=\"TopBar\">\n                <img className='logo' src={require('../assets/picture/logo.jpg').default} alt='logo'/>\n                <div className='title'>\n                    智慧医疗\n                </div>\n                <div style={{alignSelf: 'flex-end'}} className='Menu'><TopMenu/></div>\n                <div className='username'>\n                    {\n                        (this.state.getMenu===true)?(\n                            ''\n                        ):(\n                            storage['user']+',欢迎使用！'\n                        )\n                    }\n                </div>\n                {\n                    (this.state.getMenu===false && storage['identity']==='2')?(\n                        <div style={{marginLeft:'auto'}}>\n                            <Button type='primary'>\n                                <Link to={'/admin'}>管理员中心</Link>\n                            </Button>\n                        </div>\n                    ):(\n                        ''\n                    )\n                }\n                {\n                    (this.state.getMenu===false && storage['identity']==='0')?(\n                        <div style={{marginLeft:'auto'}}>\n                            <Button type='primary'>\n                                <Link to={'/PersonalInfo'}>用户中心</Link>\n                            </Button>\n                        </div>\n                    ):(\n                        ''\n                    )\n                }\n                <div className='User'>\n                    {\n                        (this.state.getMenu===true)?(\n                            <Dropdown overlay={this.loginMenu} trigger={['click']}>\n                                    <Button size='large' shape=\"circle\" icon={<UserOutlined/>}/>\n                            </Dropdown>\n                        ):(\n                            <Dropdown overlay={this.logoutMenu} trigger={['click']}>\n                                    <Button size='large' shape=\"circle\" icon={<UserOutlined/>}/>\n                            </Dropdown>\n                        )\n                    }\n                </div>\n\n                <Modal\n                    visible={this.state.visible}\n                    footer={null}\n                    onCancel={this.handleCancel}\n                    destroyOnClose={true}\n\n                >\n                    <div className=\"user-login\">\n                        <Form\n                            name=\"normal_login\"\n                            className=\"login-form\"\n                            initialValues={{remember: true,}}\n                            style={{width:\"100%\"}}\n                            preserve={false}\n                        >\n                            <Form.Item\n                                name=\"username\"\n                                rules={[\n                                    {\n                                        required: true,\n                                        message: '请输入用户名!',\n                                    },\n                                ]}\n                            >\n                                <Input\n                                    prefix={<UserOutlined className=\"site-form-item-icon\" />}\n                                    placeholder=\"用户名\"\n                                    type=\"username\"\n                                    onChange={(e)=>this.getUsername(e)}/>\n                            </Form.Item>\n\n                            <Form.Item\n                                name=\"password\"\n                                rules={[\n                                    {\n                                        required: true,\n                                        message: '请输入密码!',\n                                    },\n                                ]}\n                            >\n                                <Input.Password\n                                    prefix={<LockOutlined className=\"site-form-item-icon\" />}\n                                    type=\"password\"\n                                    placeholder=\"密码\"\n                                    onChange={(e)=>this.getPassword(e)}\n                                    iconRender={visible => (visible ? <EyeTwoTone /> : <EyeInvisibleOutlined />)}\n\n                                />\n                            </Form.Item>\n\n                            <Form.Item>\n                                <Form.Item name=\"remember\" valuePropName=\"checked\" noStyle>\n                                    <Checkbox>记住我</Checkbox>\n                                </Form.Item>\n\n                                <a className=\"login-form-forgot\" href=\"\" style={{color:'blue'}}>\n                                    <Link to=\"/FindPasswordPage/\">忘记密码</Link>\n                                </a>\n                            </Form.Item>\n\n                            <Form.Item>\n                                <Button type=\"primary\"\n                                        htmlType=\"submit\"\n                                        className=\"login-form-button\"\n                                        onClick={this.loginPost}\n                                        loading={this.state.loading}\n                                >\n                                    登录\n                                </Button>\n                                或者 <a href=\"\" style={{color:'blue'}}>\n                                <Link to=\"/RegisterPage/\">现在注册！</Link>\n                                </a>\n                            </Form.Item>\n                        </Form>\n                    </div>\n                </Modal>\n            </div>\n        )\n    }\n}\n\nexport default TopBar\n"]},"metadata":{},"sourceType":"module"}