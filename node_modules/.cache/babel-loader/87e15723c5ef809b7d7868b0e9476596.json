{"ast":null,"code":"var _jsxFileName = \"/Users/heangzhan/Desktop/se2021_part1/se2021/src/PersonalInfo/UserInfo.jsx\";\nimport React from 'react';\nimport { Layout, Menu, Form, Input, Button, message } from 'antd';\nimport { Link } from 'react-router-dom';\nimport '../assets/css/PersonalInfo.css';\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet storage = window.localStorage;\nconst defaultUrl = 'http://127.0.0.1:5003';\nconst formItemLayout = {\n  labelCol: {\n    xs: {\n      span: 24\n    },\n    sm: {\n      span: 8\n    }\n  },\n  wrapperCol: {\n    xs: {\n      span: 24\n    },\n    sm: {\n      span: 16\n    }\n  }\n};\nconst tailFormItemLayout = {\n  wrapperCol: {\n    xs: {\n      span: 24,\n      offset: 0\n    },\n    sm: {\n      span: 16,\n      offset: 8\n    }\n  }\n};\nlet newNickname = '';\nlet newEmail = '';\nlet newPhone = '';\n\nclass UserInfo extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.getNickname = e => {\n      newNickname = e.target.value;\n    };\n\n    this.getEmail = e => {\n      newEmail = e.target.value;\n    };\n\n    this.getPhone = e => {\n      newPhone = e.target.value;\n    };\n\n    this.infoModPost = () => {\n      this.setState({\n        infoModLoading: true\n      });\n      let params = {\n        uid: this.state.username,\n        email: newEmail,\n        nickname: newNickname,\n        phone: newPhone\n      };\n      console.log(params);\n      axios({\n        baseURL: defaultUrl,\n        method: 'post',\n        url: '/infoModPage',\n        params\n      }).then(res => {\n        console.log(res.data.msg);\n\n        if (!res.data.code) {\n          message.success('个人信息修改成功!');\n          this.setState({\n            infoModLoading: false,\n            nickname: newNickname,\n            email: newEmail,\n            phone: newPhone\n          }); // window.location.href = \"http://localhost:3000\"\n        } else {\n          message.error('修改失败请重试！');\n          this.setState({\n            infoModLoading: false\n          });\n        }\n      });\n    };\n\n    this.getOldPassword = e => {\n      this.setState({\n        oldPassword: e.target.value\n      });\n    };\n\n    this.getNewPassword = e => {\n      this.setState({\n        newPassword: e.target.value\n      });\n    };\n\n    this.psdModPost = () => {\n      this.setState({\n        psdModLoading: true\n      });\n      let params = {\n        uid: this.state.uid,\n        oldPassword: this.state.oldPassword,\n        newPassword: this.state.newPassword\n      };\n      console.log(params);\n      axios({\n        baseURL: defaultUrl,\n        method: 'post',\n        url: '/psdModPage',\n        params\n      }).then(res => {\n        console.log(res.data.msg);\n\n        if (!res.data.code) {\n          message.success('密码修改成功，请重新登录!');\n          this.setState({\n            psdModLoading: false\n          });\n          storage.removeItem(\"user\");\n          storage.removeItem(\"token\");\n          storage.removeItem('identity');\n          storage.removeItem(\"nickname\");\n          storage.removeItem(\"email\");\n          storage.removeItem('phone');\n          storage.removeItem('address');\n          window.location.href = \"http://localhost:3000\";\n        } else {\n          message.error('修改失败请重试！');\n          this.setState({\n            psdModLoading: false\n          });\n        }\n      });\n    };\n\n    this.state = {\n      username: storage['user'],\n      identity: storage['identity'],\n      nickname: storage['nickname'],\n      email: storage['email'],\n      phone: storage['phone'],\n      address: '',\n      collapsed: false,\n      infoModLoading: false,\n      psdModLoading: false,\n      oldPassword: '',\n      newPassword: ''\n    };\n  }\n\n  componentDidMount() {\n    newNickname = this.state.nickname;\n    newPhone = this.state.phone;\n    newEmail = this.state.email;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Form, {\n      className: \"personalInfo-form\",\n      style: {\n        width: \"50%\"\n      },\n      ...formItemLayout,\n      name: \"personalInfo\",\n      scrollToFirstError: true,\n      children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"uid\",\n        label: \"\\u8EAB\\u4EFD\\u8BC1\\u53F7\",\n        children: this.state.username\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"nickname\",\n        label: \"\\u7528\\u6237\\u6635\\u79F0\",\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.nickname,\n          onChange: e => this.getNickname(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"email\",\n        label: \"\\u6CE8\\u518C\\u90AE\\u7BB1\",\n        rules: [{\n          type: 'email',\n          message: '请输入正确的邮件地址!'\n        }],\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.email,\n          onChange: e => this.getEmail(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"phone\",\n        label: \"\\u8054\\u7CFB\\u7535\\u8BDD\",\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          placeholder: this.state.phone,\n          onChange: e => this.getPhone(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, { ...tailFormItemLayout,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          onClick: this.infoModPost,\n          loading: this.state.infoModLoading,\n          children: \"\\u4FEE\\u6539\\u8D44\\u6599\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"oldPassword\",\n        label: \"\\u8F93\\u5165\\u65E7\\u5BC6\\u7801\",\n        hasFeedback: true,\n        children: /*#__PURE__*/_jsxDEV(Input.Password, {\n          onChange: e => this.getOldPassword(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"newPassword\",\n        label: \"\\u8F93\\u5165\\u65B0\\u5BC6\\u7801\",\n        hasFeedback: true,\n        children: /*#__PURE__*/_jsxDEV(Input.Password, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        name: \"confirm\",\n        label: \"\\u786E\\u8BA4\\u65B0\\u5BC6\\u7801\",\n        dependencies: ['newPassword'],\n        hasFeedback: true,\n        rules: [({\n          getFieldValue\n        }) => ({\n          validator(_, value) {\n            if (!value || getFieldValue('password') === value) {\n              return Promise.resolve();\n            }\n\n            return Promise.reject(new Error('两次密码不一致!'));\n          }\n\n        })],\n        children: /*#__PURE__*/_jsxDEV(Input.Password, {\n          onChange: e => this.getNewPassword(e)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Form.Item, { ...tailFormItemLayout,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          onClick: this.psdModPost,\n          loading: this.state.psdModLoading,\n          children: \"\\u4FEE\\u6539\\u5BC6\\u7801\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default UserInfo;","map":{"version":3,"sources":["/Users/heangzhan/Desktop/se2021_part1/se2021/src/PersonalInfo/UserInfo.jsx"],"names":["React","Layout","Menu","Form","Input","Button","message","Link","axios","storage","window","localStorage","defaultUrl","formItemLayout","labelCol","xs","span","sm","wrapperCol","tailFormItemLayout","offset","newNickname","newEmail","newPhone","UserInfo","Component","constructor","props","getNickname","e","target","value","getEmail","getPhone","infoModPost","setState","infoModLoading","params","uid","state","username","email","nickname","phone","console","log","baseURL","method","url","then","res","data","msg","code","success","error","getOldPassword","oldPassword","getNewPassword","newPassword","psdModPost","psdModLoading","removeItem","location","href","identity","address","collapsed","componentDidMount","render","width","type","getFieldValue","validator","_","Promise","resolve","reject","Error"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {Layout, Menu, Form, Input, Button, message} from 'antd';\nimport { Link } from 'react-router-dom';\nimport '../assets/css/PersonalInfo.css';\nimport axios from \"axios\";\n\nlet storage = window.localStorage;\nconst defaultUrl = 'http://127.0.0.1:5003';\n\nconst formItemLayout = {\n    labelCol: {\n        xs: { span: 24 },\n        sm: { span: 8 },\n    },\n    wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 },\n    },\n};\nconst tailFormItemLayout = {\n    wrapperCol: {\n        xs: {\n            span: 24,\n            offset: 0,\n        },\n        sm: {\n            span: 16,\n            offset: 8,\n        },\n    },\n};\n\nlet newNickname = '';\nlet newEmail = '';\nlet newPhone = '';\n\nclass UserInfo extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state={\n            username:storage['user'],\n            identity:storage['identity'],\n            nickname:storage['nickname'],\n            email:storage['email'],\n            phone:storage['phone'],\n            address:'',\n            collapsed: false,\n            infoModLoading:false,\n            psdModLoading:false,\n            oldPassword:'',\n            newPassword:'',\n        }\n    }\n\n    componentDidMount() {\n        newNickname = this.state.nickname\n        newPhone = this.state.phone\n        newEmail = this.state.email\n    }\n\n    getNickname=(e)=>{\n        newNickname = e.target.value\n    }\n\n    getEmail=(e)=>{\n        newEmail = e.target.value\n    }\n\n    getPhone=(e)=>{\n        newPhone = e.target.value\n    }\n\n    infoModPost=()=>{\n        this.setState({\n            infoModLoading:true\n        });\n        let params={\n            uid:this.state.username,\n            email:newEmail,\n            nickname:newNickname,\n            phone:newPhone,\n        };\n        console.log(params)\n        axios({\n            baseURL:defaultUrl,\n            method:'post',\n            url:'/infoModPage',\n            params,\n        }).then(res=>{\n            console.log(res.data.msg)\n            if(!res.data.code) {\n                message.success('个人信息修改成功!');\n                this.setState({\n                    infoModLoading:false,\n                    nickname:newNickname,\n                    email:newEmail,\n                    phone:newPhone,\n                });\n                // window.location.href = \"http://localhost:3000\"\n            }\n            else{\n                message.error('修改失败请重试！');\n                this.setState({\n                    infoModLoading:false,\n                });\n            }\n        })\n    }\n\n    getOldPassword=(e)=>{\n        this.setState({\n            oldPassword:e.target.value\n        })\n    }\n\n    getNewPassword=(e)=>{\n        this.setState({\n            newPassword:e.target.value\n        })\n    }\n\n    psdModPost=()=>{\n        this.setState({\n            psdModLoading:true\n        });\n        let params={\n            uid:this.state.uid,\n            oldPassword: this.state.oldPassword,\n            newPassword: this.state.newPassword,\n        };\n        console.log(params)\n        axios({\n            baseURL:defaultUrl,\n            method:'post',\n            url:'/psdModPage',\n            params,\n        }).then(res=>{\n            console.log(res.data.msg)\n            if(!res.data.code) {\n                message.success('密码修改成功，请重新登录!');\n                this.setState({\n                    psdModLoading:false,\n                });\n                storage.removeItem(\"user\");\n                storage.removeItem(\"token\");\n                storage.removeItem('identity')\n                storage.removeItem(\"nickname\");\n                storage.removeItem(\"email\");\n                storage.removeItem('phone');\n                storage.removeItem('address');\n                window.location.href = \"http://localhost:3000\"\n            }\n            else{\n                message.error('修改失败请重试！');\n                this.setState({\n                    psdModLoading:false,\n                });\n            }\n        })\n    }\n\n    render() {\n        return (\n            <Form\n                className=\"personalInfo-form\"\n                style={{width:\"50%\"}}\n                {...formItemLayout}\n                name=\"personalInfo\"\n                scrollToFirstError\n            >\n                <Form.Item\n                    name=\"uid\"\n                    label=\"身份证号\"\n                >\n                    {this.state.username}\n                </Form.Item>\n\n                <Form.Item\n                    name=\"nickname\"\n                    label=\"用户昵称\"\n                >\n                    <Input\n                        placeholder={this.state.nickname}\n                        onChange={(e)=>this.getNickname(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item\n                    name=\"email\"\n                    label=\"注册邮箱\"\n                    rules={[\n                        {\n                            type: 'email',\n                            message: '请输入正确的邮件地址!',\n                        }\n                    ]}\n                >\n                    <Input\n                        placeholder={this.state.email}\n                        onChange={(e)=>this.getEmail(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item\n                    name=\"phone\"\n                    label=\"联系电话\"\n                >\n                    <Input\n                        placeholder={this.state.phone}\n                        onChange={(e)=>this.getPhone(e)}\n                    />\n                </Form.Item>\n\n                <Form.Item {...tailFormItemLayout}>\n                    <Button\n                        type=\"primary\"\n                        htmlType=\"submit\"\n                        onClick={this.infoModPost}\n                        loading={this.state.infoModLoading}\n                    >\n                        修改资料\n                    </Button>\n                </Form.Item>\n\n                <Form.Item\n                    name=\"oldPassword\"\n                    label=\"输入旧密码\"\n                    hasFeedback\n                >\n                    <Input.Password onChange={(e)=>this.getOldPassword(e)}/>\n                </Form.Item>\n\n                <Form.Item\n                    name=\"newPassword\"\n                    label=\"输入新密码\"\n                    hasFeedback\n                >\n                    <Input.Password/>\n                </Form.Item>\n\n                <Form.Item\n                    name=\"confirm\"\n                    label=\"确认新密码\"\n                    dependencies={['newPassword']}\n                    hasFeedback\n                    rules={[\n                        ({ getFieldValue }) => ({validator(_, value) {\n                            if (!value || getFieldValue('password') === value) {\n                                return Promise.resolve();\n                            }\n                            return Promise.reject(new Error('两次密码不一致!'));\n                        },}),\n                    ]}\n                >\n                    <Input.Password onChange={(e)=>this.getNewPassword(e)}/>\n                </Form.Item>\n\n                <Form.Item {...tailFormItemLayout}>\n                    <Button\n                        type=\"primary\"\n                        htmlType=\"submit\"\n                        onClick={this.psdModPost}\n                        loading={this.state.psdModLoading}\n                    >\n                        修改密码\n                    </Button>\n                </Form.Item>\n            </Form>\n      )\n    }\n}\n\nexport default UserInfo;\n"]},"metadata":{},"sourceType":"module"}